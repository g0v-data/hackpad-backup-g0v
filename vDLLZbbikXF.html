<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="en-us" />
<meta name="version" content="4196"/>
<style>body {font-family:Helvetica}ul.comment{list-style-image:url('https://hackpad.com/static/img/comment.png');} ul.task{list-style-image:url('https://hackpad.com/static/img/unchecked.png');}ul.taskdone{list-style-image:url('https://hackpad.com/static/img/checked.png');} </style><title>/683$vDLLZbbikXF</title>
</head>
<body><h1>一鍵 Excel 轉 .csv (含自動修復) (Ver20160305)</h1><p></p><h2>專案簡介</h2><p><b>最新版本下載 (Latest released version)</b></p><ul><li>Excel_to_csv Delta(2016.05.17)&nbsp;<ul><li><a href='https://drive.google.com/file/d/0B0l5ONZZiOChNDBONlhJSElBSFU/view?usp=sharing'/>Google drive連結</a></li></ul>
</li>
<li><a href='https://drive.google.com/file/d/0B0l5ONZZiOChZUJsZjF2blNHVlk/view?usp=sharing'/>安裝說明書(Google drive)</a> (目前僅針對windows OS,&nbsp; MS office 2010+)<ul><li>mac OS、其他office 目前還沒摸透，<b><u>跪求白老鼠測試</u></b></li></ul>
</li>
<li>測試範例檔案 (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChMURJMGVRaC13eWc/view?usp=sharing'/>測試用範例一</a>) (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChY3RWcHlYZ1hhMVk/view?usp=sharing'/>測試用範例二</a>) (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChV2xqTHRvby1iT0E/view?usp=sharing'/>測試用範例三</a>)</li></ul>

<ul><li>另外根據Ronny的<a href='/Excel--jkpco57DjJH'/>Excel轉換工具</a>寫了合併工作表的VBA<ul><li>google drive連結 (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChU0VyYTZBSkRvSmc/view?usp=sharing'/>檔案下載點我</a>)</li>
<li>安裝方法相同</li>
<li>適用於 每個工作表都有類似的資料需要合併<ul><li>例如不同的工作表 為 不同的縣市</li>
<li>都有一樣的資料類型 (首列)</li></ul>
</li>
<li>依照Ronny的建議加上「首欄=工作表名稱」 的選項</li>
<li>可以選擇轉換完是否自動另存成csv</li>
<li>測試範例檔案 (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChUzhKU3k4NG5TVkE/view?usp=sharing'/>測試用範例一</a>) (<a href='https://drive.google.com/file/d/0B0l5ONZZiOChMTJFVk8tV3RJUkE/view?usp=sharing'/>測試用範例二</a>)</li></ul>
</ul>

<p><b>緣由</b></p><p>看到Peggy的<a href='https://hackpad.com/Lesson-1-ver1.0-XdDvvmJJ6Zf'/>公務員開放資料Lesson 1 </a>，想說有沒有辦法直接開發程式供公務人員使用，減少轉檔後的資料格式問題</p><p></p><ul class="comment"><li>跪謝Q_____________Q</li>
<li>等下想討論：</li>
<li>1. 用 &quot;VBA&quot; 跟 &quot;Ronny做成網站&quot; 這兩種方式，哪一種比較容易使用？</li>
<li>2. VBA的功能可以也變成線上化的方式進行嗎？反之把網站功能做成VBA？</li>
<li>3. 哪一個方法比較容易、還是不同功能必須用不同方法？</li>
<li>1.&nbsp; VBA完成後可以直接變成EXCEL中的一個按鈕，EXCEL開了就可以用，沒有網路也可以；但相對的，第一次安裝也需要一些步驟。另外缺點就是更新比較困難，每次CODE更新就要重新設定一次。個人認為VBA方法對公務員比較友善，但對替代役或資訊人員比較麻煩。</li>
<li>2. &amp; 3.&nbsp; 然後兩種方法核心應該依樣吧，不過語法有些不同，但理論上是可以互相轉換的。</li>
<li>理解.....等下討論！</li>
<li>Ronny有提到 如何讓使用者對於資安沒有疑慮</li>
<li><br/></li>
<li>不好意思插入一個問題， .ods格式在轉換上問題會比較少嗎? 還是說因為現成資源較少所以反而要重新開發?</li>
<li>其實我不懂.ods，可以等下介紹 / 討論一下。</li>
<li>好的，我其實也想蒐集一下大家對於data.gov.tw的想法XD（這次應該先挖坑的...orz）</li></ul>

<p></p><p></p><p><b>要解決的問題</b></p><ol><li>減少Excel檔案轉成.csv的步驟，以節省時間及降低人為犯錯機率</li>
<li>自動修正Excel中轉成.csv時造成錯誤的潛在因子，確保轉出的.csv可供後續正確使用</li>
<li>不要破壞原本「方便人閱讀的格式」，降低使用者抗拒因素</li></ol>

<p><b>預定使用者</b></p><p>不習慣將Excel編輯成符合資料庫格式，但又想將其轉成csv成為開放資料的人</p><p></p><p><b>預定功能</b></p><ol><li>功能<ol><li>修正合併儲存格(跨至欄中)的問題<ol><li>搜尋資料表中的合併儲存格</li>
<li>解除合併並將資料整合</li></ol>
<ul style="list-style: none;"><li><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451116449949_undefined'/></li>
<li>↓↓↓↓↓↓↓變成↓↓↓↓↓↓</li>
<li><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451116539806_undefined'/></li>
<li><br/></li></ul>
</ol>
<ol><li>去除可能會造成錯誤之符號 (如 數字間的逗號 1,230,000 )<ol><li>方法一：強制消去全部的,&nbsp; (但要考慮會不會有其他文字屬性欄位也含有半形逗號)</li>
<li>方法二：將全部欄位改成無千位數逗號之數字 (但要小心破壞其他儲存格之內容)</li></ol>
</li>
<li>儲存<ol><li>另存成.csv檔案</li>
<li>檔案名稱為&nbsp; 原本檔案名稱 + 工作表名稱 + &quot;.csv&quot;</li>
<li>編碼格式自動選為 UTF8</li></ol>
</li>
<li>其他功能 (待補充)</li></ol>
<ul class="comment"><li>預計新增幾個功能</li>
<li>&lt;A&gt; 同一個檔案的不同工作表合併&nbsp;&nbsp;</li>
<li>&lt;B&gt; 將同一個檔案的各個工作表分別轉出</li></ul>
<ul style="list-style: none;"><li><br/></li></ul>
</ol>
<ol><li>介面<ol><li>掛在EXCEL介面中之巨集按鈕&nbsp;<ol><li>優點：</li><ul><li>使用方便簡單</li></ul>
</ol>
<ol><li>缺點：</li><ul><li>安裝問題（如何讓使用者順利把巨集載到Excel中，並形成按鈕）</li>
<li>版本更新問題</li>
<li>安全性檢查（巨集是否會被系統阻擋）</li></ul>
</ol>
</ol>
<ol><li>額外執行程式<ol><li>優點：</li><ul><li>執行檔容易傳播使用</li>
<li>可以透過GUI設計讓使用起來方便</li></ul>
</ol>
<ol><li>缺點：</li><ul><li>操作步驟可能較麻煩（要先選擇目標檔案，在執行）</li>
<li>程式碼相容性問題</li></ul>
</ol>
</ol>
<ol><li><a href='/ep/profile/tC7Bqff8Vp0'/>Ronny Wang</a>的網頁版本 (<a href='/Excel--jkpco57DjJH'/>連結</a>)<ol><li>優點：</li><ul><li>不需要安裝</li>
<li>更新容易</li></ul>
</ol>
</ol>
</ol>

<p><b>現有類似專案</b></p><p>Ronny大大好像之前有做出 潛在錯誤檢查程式</p><p></p><p><b>相關專案</b></p><p>???</p><p></p><p><b>授權方式</b></p><p>cc by</p><p></p><p><b>使用資料</b></p><p>無</p><p></p><p><b>相關資訊</b></p><p>Archain昨天有在問，公務員目前的電腦office是哪個版本，我剛先問了一下我們(衛福部)資訊處部內的狀況：</p><ol><li>目前全面是2010的版本。</li>
<li>行政院有指示，2010以前的版本因為不再更新，資安上有疑慮，所以不得使用。</li>
<li>至於什麼時候會換2013，目前還不知道，應該是看微軟何時停止更新2010。</li></ol>
<p>以上資訊提供。</p><ul class="comment"><li>很有幫助的資訊，因為2003和2007對巨集和工具列限制比較多</li>
<li><br/></li></ul>
<p>路過補充地方政府情形：</p><p>根據2015年收資料的經驗，若散發office2010格式檔案給各縣市政府(的下屬局處單位)，大約有1/10的回收資料會用office 97-2003的格式回來。</p><ul class="comment"><li>感謝回饋。目前測試結果，似乎檔案本身版本不是很重要，但執行的office版本影響很大。會再持續實驗。</li></ul>

<p><b>專案目前狀態</b></p><ol><li>Delta版本完成，釋出日期為2016.05.17。 <a href='https://drive.google.com/file/d/0B0l5ONZZiOChNDBONlhJSElBSFU/view?usp=sharing'/>Google drive連結</a></li><ul><li>執行前自動備份</li>
<li>修正部份bug</li>
<li>註解增加</li>
<li>目前尚未解決之問題<ul><li><b>有些Case在「項目」會分別有中文和英文兩個row，目前沒辦法自動合併</b></li>
<li><b>有些Case在奇怪的地方(如最下面)會有合併儲存格，無法正常消除</b></li></ul>
</ul>
</ol>
<ol><li>VBA巨集C-Gamma版完成，為2016.03.05 g0v黑客松後釋出版本<a href='https://drive.google.com/file/d/0B0l5ONZZiOChU3VGQmhLY0Zwd00/view?usp=sharing'/>Google drive連結</a></li><ul><li>【不重要資訊：之所以Gamma前有個C字，是為了排序】</li></ul>
</ol>
<ol><li>VBA巨集beta版(<a href='https://www.dropbox.com/s/nq8shzk6bu10649/Excel_to_csv_Beta_20160305.xlsm?dl=0'/>dropbox連結</a>)完成，暫定工作環境為office2010。 (2016.03.01)</li><ul><li>新增<a href='https://drive.google.com/file/d/0B0l5ONZZiOChMzV1MEdvcENLXzQ/view?usp=sharing'/>google雲端硬碟下載連結</a>。</li>
<li>請下載後使用，點選第一頁的Run。若要再次測試，請關閉檔案重新開啟。</li>
<li>將巨集指令加到Excel工具列中便可對其他文件使用，但目前還沒有極簡單且簡便的版本。<ul><li>人工設定可以先參考<a href='https://www.facebook.com/johnsonliang?fref=ufi'/>Johnson Liang</a>之前錄製的<a href='http://i.giphy.com/3o7ZeMOtVaygEDsbu0.gif'/>方法</a>，不過每次使用都會冒出一個額外的excel視窗。</li>
<li><a href='https://drive.google.com/file/d/0B0l5ONZZiOChZUJsZjF2blNHVlk/view?usp=sharing'/>安裝說明書</a></li>
<li>尚在研究更簡單、自動設定，且不會產生額外視窗的方法。<ul><li>基本上將巨集寫進Personal.xlsb中，就不會有額外視窗</li></ul>
</li></ul>
</li>
<li>beta版新增可以處理的部份 (alpha版功能繼承)</li><ol><li>自動判別資料範圍</li>
<li>儲存時不再留下原始資料的副檔名</li>
<li>修正儲存路徑為原始檔案的同資料夾內</li>
<li>自動去除多餘的空白列、註解列</li><ul><li>Beta版測試</li>
<li>Before</li></ul>
</ol>
</ul>
</ol>

<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1457151115321_undefined'/></p><p></p><ul><li>After</li></ul>
<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1457151174553_undefined'/></p><p></p><ul><li>beta版尚未處理的問題</li><ol><li>尚未完全驗證</li>
<li>一次處理同一檔案中的所有分頁 (code已完成，尚未實裝)</li>
<li>當已有同名檔案時，要怎麼處理</li>
<li>存完後是否自動關閉檔案（執行中的為.csv)&nbsp;</li>
<li>讓使用者可以很簡單地把巨集置放於工具列</li></ol>
</ul>

<ul class="comment"><li>發現問題，資料表欄列太多時會卡住 (上限待測試)</li>
<li>公務員表示 dropbox會被公家機關網路擋住，可以改用google</li>
<li><br/></li><ul><li><br/></li></ul>
</ul>
<ol><li>VBA巨集<a href='https://www.dropbox.com/s/udh6esh63bririi/Excel_to_csv_alpha.xlsm?dl=0'/>alpha版</a>完成，測試中<i>&nbsp;&nbsp; </i>(2015)</li><ul><li>請<a href='https://www.dropbox.com/s/udh6esh63bririi/Excel_to_csv_alpha.xlsm?dl=0'/>下載</a>後使用，點選第一頁的Run。若要再次測試，請關閉檔案重新開啟。</li>
<li>目前可處理部份</li><ol><li>一鍵完成（不過還沒做好巨集指令移轉，所以只能在範例檔中使用）</li>
<li>解決「簡單的合併儲存格」問題</li>
<li>消除數字中的半形逗號</li>
<li>自動以「同樣的檔名」、「 UTF8編碼格式」儲存成.csv</li></ol>
</ul>
</ol>

<ul><li>目前尚未處理的問題</li><ol><li>未驗證是否適用於各種合併儲存格之情況</li>
<li>未能自動判別資料總行列數，所以目前固定只掃到10x10</li>
<li>原始檔案的附檔名會留著 （如XXX.xls.csv）</li>
<li>一次處理不同分頁、大量檔案</li>
<li>當已有同名檔案時，要怎麼處理</li>
<li>存完後是否自動關閉檔案（執行中的為.csv）</li>
<li>讓使用者可以很簡單地把巨集置放於工具列</li></ol>
</ul>

<p></p><ul><li>目前效果 (使用<b>前</b> in excel)　　<i>(表格內容為假想內容)</i></li></ul>
<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451226860875_undefined'/></p><ul><li>目前效果 (使用<b>後</b> in excel)</li></ul>
<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451226968464_undefined'/></p><ul><li>目前效果(使用<b>前</b> in wordpad)</li></ul>
<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451229138223_undefined'/></p><ul><li>目前效果(使用<b>後</b> in wordpad)</li></ul>
<p><img src='https://hackpad-attachments.s3.amazonaws.com/g0v.hackpad.com_vDLLZbbikXF_p.534607_1451229264796_undefined'/></p><p></p><p><b>利益揭露</b></p><p>應該是沒有吧</p><p></p><p></p><h2>使用者回饋</h2><ul class="comment"><li>這陣子找同事幫測結果↓↓</li></ul>

<p><b>整體建議</b></p><ul class="taskdone"><li>如果沒有全部轉成功，會需要看原本轉之前的資料，但使用VBA轉完不能按復原</li></ul>
<ul class="comment"><li>這好像是vba天生的限制，目前想法是在進行轉換之前先另存新檔備份。</li></ul>
<ul class="taskdone"><li>轉存的csv必須是UTF8 (Q__Q 目前都被要求必須是UTF8編碼)</li></ul>
<ul class="comment"><li>我看code目前有自動設定成UTF8，如果有發生編碼錯誤，請再和我說。</li></ul>
<ul class="task"><li>由於會有一些狀況是無法以這個VBA處理的(下面案例會寫)，但是執行VBA後它就會直接轉csv；但通常的流程是：1使用VBA處理合併儲存格 → 2繼續在excel中清資料 → 3才需要存csv，目前會在第1步就先轉成csv，所以第3步的時候儲存時有時會記得存csv但反而忘記把原本excel存起來。又或是，如果是多個工作表，按下VBA之後就會自動存成很多csv檔，或再做修改、再儲存時就會有點怕會出問題，最後就會覺得再按一次VBA好了。</li></ul>

<p>[以下是吹毛求疵的建議，大多是一些與合併儲存格無關的問題~~~~]</p><p></p><p><b>無法處理：<a href='https://www.dropbox.com/s/ehgcz1pcjpcs5k2/%E3%80%90%E7%B4%94%E6%95%99%E6%9D%90%E3%80%91%E9%AB%98%E8%A1%80%E5%A3%93%E8%B3%87%E6%96%99.xlsx?dl=0'/>資料集連結</a></b></p><ul class="task"><li>最右邊的「平均」，跑完之後「平」被刪掉了，未被併入平均同一格</li>
<li>小計、總計欄位無法刪除 (理想狀態下希望刪除)</li>
<li>左上角的欄位名稱會維持空白 (正確做法要加上「縣市別」，但應該沒法這麼聰明XD)</li></ul>
<ul class="comment"><li>這檔案的難度很高，應該說對於本身沒有合併儲存格的，這程式好像反而無法處理。</li></ul>

<p><b>無法處理：<a href='https://www.dropbox.com/s/wqa8p0a8zo87bbj/%E7%B6%9C%E5%90%88%E6%BC%94%E7%B7%B4%E6%A1%88%E4%BE%8B.xls?dl=0'/>資料集連結</a></b></p><ul class="taskdone"><li>不知道為什麼第一行不見了QQ</li></ul>
<ul class="comment"><li>程式bug，已找到原因，要想一下怎麼處理</li></ul>
<ul class="task"><li>最下面的「平均」其實應該要整行刪除，但是因為原本有合併儲存格，所以反而被拆成四個儲存格都寫平均</li></ul>
<ul class="comment"><li>有想到解決方法，但要測試會不會矯枉過正</li></ul>
<ul class="taskdone"><li>最下面表尾用文字方塊插入的內容沒有刪除</li></ul>
<ul class="comment"><li>實際上因為csv不支援文字方塊，所以該方塊並不會被儲存，excel關掉重開檔案會發現它已消失</li></ul>

<p><b>無法處理：<a href='https://www.dropbox.com/s/n36wpv6dq7mdyss/104%E5%B9%B412%E6%9C%88%E4%BE%9D%E6%B3%95%E6%87%89%E8%A8%AD%E7%BD%AE%E5%93%BA%E9%9B%86%E4%B9%B3%E5%AE%A4%E5%90%8D%E5%96%AE.xls?dl=0'/>資料集連結</a></b></p><ul class="task"><li>多個sheet，不知道為什麼轉出來的名字會都套用第一個sheet的基隆市</li></ul>
<ul class="comment"><li>我這邊測試是正常的，我猜會發生這問題應該是使用者對同一個檔案執行了兩次vba</li>
<li>然後第一次是選轉單頁，第二次轉全部</li>
<li>如此第一次會把excel的第一頁「基隆市」轉成csv；其他分頁雖然未被儲存，但仍會在excel視窗中&nbsp;</li>
<li>而第一次轉換已經把「基隆市」加在標題後面</li>
<li>在第二次轉換時，全部縣市就又被加在後面了，所以產生了這樣的問題</li>
<li>建議：每次轉換完成後，若要再次轉換，把當前檔案關閉並重新開啟原始檔執行</li></ul>

<p><img src='https://hackpad-attachments.s3.amazonaws.com/hackpad.com_XQH7KZ69Bbv_p.34080_1460476465976_3.png'/></p><p></p><p><b>無法處理：<a href='https://www.dropbox.com/s/3pdd1m6zcdvkxky/%E7%B6%9C%E5%90%88%E6%BC%94%E7%B7%B4%E6%A1%88%E4%BE%8B.xlsx?dl=0'/>資料集連結</a></b></p><ul class="task"><li>跟前面提的類似，左上角空白欄位、總計欄位無法處理</li></ul>

<p></p><p></p><h2>徵求協作者</h2><ul class="task"><li>NeedsTech: 需要技術支援（VBA 或 其他使用者友善介面)</li>
<li>NeedsPotentialUser: 需要使用者 / 推廣者 給予操作心得，以改善介面或增減功能</li>
<li>NeedsOpenDataUser: 需要有人以開放資料使用者/網站設計者 之角度給予建議</li></ul>

<p></p><h2>實作細節（非技術背景可跳填）</h2><p></p><p><b>協作工具</b></p><ul><li>github repo：</li>
<li>hackfoldr 工作資料夾網址：</li>
<li>google drive 共用資料夾網址：</li></ul>

<p><b>進度與 to-do</b></p><ul class="comment"><li>僅供參考</li></ul>
<ul class="task"><li>product planning（recommanded procedure from justin lee / 李易修）<ul class="task"><li>strategy</li>
<li>scope</li>
<li>structure</li>
<li>wireframe</li>
<li>visual</li></ul class="task">
</li>
<li>web front-end</li>
<li>web back-end</li>
<li>ui / visual design</li></ul>

<p></p><h2>成果展示（規劃文件、雛形/草稿、原型/初稿、正式發佈/完稿）</h2><p></p><p></p><p></p><p></p><p></p></body>
</html>
