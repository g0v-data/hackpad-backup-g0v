<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta http-equiv="Content-Language" content="en-us" />
<meta name="version" content="42"/>
<style>body {font-family:Helvetica}ul.comment{list-style-image:url('https://hackpad.com/static/img/comment.png');} ul.task{list-style-image:url('https://hackpad.com/static/img/unchecked.png');}ul.taskdone{list-style-image:url('https://hackpad.com/static/img/checked.png');} </style><title>/683$KOVMEoU8IOv</title>
</head>
<body><h1>WIN SCRIPT</h1><p></p><p></p><h2>MM8005 script</h2><p>wi_server_modem_build_generic.bat <a href="ssh://khlui@192.168.100.101:29418/AMSS/modem.git"></a>ssh://khlui@192.168.100.101:29418/AMSS/modem.git mm8005.develop 8610.release BAAAANAZ 1 KH_SERVER_ROBOT</p><p></p><h2>wi_server_modem_build_generic.bat </h2><p>@echo off</p><p></p><p>REM git exe</p><p>IF EXIST c:&#92;cygwin64&#92;bin&#92;git.exe (</p><p>&nbsp; set gitexe=c:&#92;cygwin64&#92;bin&#92;git.exe</p><p>) else (</p><p>&nbsp; set gitexe=&quot;C:&#92;Program Files (x86)&#92;Git&#92;bin&#92;git.exe&quot;</p><p>)</p><p></p><p>echo kh debug %gitexe%</p><p></p><p>REM save script pwd</p><p>set scriptfolder=%cd%</p><p></p><p>REM config data</p><p>set projbranch=%2</p><p>set gitbranch=-b %projbranch%</p><p>REM set codeurl=<a href="git://192.168.100.101/hipadHive/AMSS/modem.git"></a>git://192.168.100.101/hipadHive/AMSS/modem.git</p><p>set codeurl=%1</p><p>set giturl=%codeurl% %gitbranch%</p><p>REM you must set gitFolder and romFolder in the same window partition, gitFolderD uses to go to this partition</p><p>set gitFolderD=d:</p><p>set yourDfoldername=sharerom</p><p>set gitFolder=d:&#92;autobuild</p><p>set romFolder=d:&#92;%yourDfoldername%</p><p>set romFolderNWname=&#92;&#92;%COMPUTERNAME%&#92;%yourDfoldername%&#92;</p><p></p><p>REM MM8005 8610.release BUILD_ID=BAAAANAZ</p><p>REM fq9010/cmcc 8916.gen.prod&nbsp;</p><p>set buildcmd=%3</p><p></p><p>REM fq9010/cmcc gen.prod EAAAANVZ</p><p>REM MM8005 8610.release BAAAANAZ</p><p>set binfolder=%4</p><p></p><p>REM local 0, global 1</p><p>set local_global=%5</p><p></p><p>set message=%6</p><p></p><p>REM hipadwi is a public account for us</p><p>set mailacc=hipadwi@gmail.com</p><p>set mailpwd=hipadwi~1</p><p></p><p>IF %local_global%==1 (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set mailto=khlui@hipad.com;darrenyang@hipad.com;oliverchou@hipad.com;albertli@hipad.com;jaylin@hipad.com;chriswang@hipad.com;samlee@hipad.com;joeychien@hipad.com</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; REM set mailto=khlui@hipad.com</p><p>) ELSE (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for /F &quot;tokens=*&quot; %%a in (&rsquo;%gitexe% config --global user.email&rsquo;) do (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set mailto=%%a</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; )</p><p>)</p><p>set gmailsmtp=smtp.gmail.com:25</p><p>set mailsubjectheader=[WI build robot]</p><p>set mailsubject=</p><p>set mailbody=</p><p></p><p>REM create current time folder name</p><p>for /f &quot;tokens=1-4 delims=-/ &quot; %%i IN (&quot;%date%&quot;) DO (</p><p>set year=%%i</p><p>set month=%%j</p><p>set day=%%k</p><p>)</p><p></p><p>for /f &quot;tokens=1-4 delims=:.&quot; %%i IN (&quot;%time%&quot;) DO (</p><p>set hour=%%i</p><p>set minute=%%j</p><p>set second=%%k</p><p>set centisecond=%%l</p><p>)</p><p></p><p>IF %local_global%==1 (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set folder_name=%year%%month%%day%_%hour%%minute%%second%_%centisecond%_%projbranch%_WI_SERVER_GEN</p><p>) ELSE (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; set folder_name=%year%%month%%day%_%hour%%minute%%second%_%centisecond%_%projbranch%_LOCAL</p><p>)</p><p>set tiptxt=%romFolder%&#92;%folder_name%&#92;readme.txt</p><p></p><p>REM start command line here</p><p>%gitFolderD%</p><p></p><p>IF NOT EXIST %romFolder% mkdir %romFolder%</p><p>mkdir %romFolder%&#92;%folder_name%</p><p></p><p>REM server auto build need to clone code</p><p>IF %local_global%==1 (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IF NOT EXIST %gitFolder% mkdir %gitFolder%</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mkdir %gitFolder%&#92;%folder_name%</p><p></p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cd %gitFolder%&#92;%folder_name%</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; %gitexe% clone %giturl% %gitbranch%</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cd modem</p><p>)</p><p></p><p>REM already under modem folder</p><p>%gitexe% log &gt; %romFolder%&#92;%folder_name%&#92;gitlog.txt</p><p>%gitexe% branch &gt; %romFolder%&#92;%folder_name%&#92;gitbranch.txt</p><p>echo git clone %giturl% &gt; %tiptxt%</p><p></p><p>REM auto record local diff</p><p>IF %local_global%==0 (</p><p>cp .gitignore .gitignore.back</p><p>echo build/ &gt; .gitignore</p><p>echo *.pyc &gt;&gt; .gitignore</p><p>echo *.pyo &gt;&gt; .gitignore</p><p>echo *.txt &gt;&gt; .gitignore</p><p>echo *.cmm &gt;&gt; .gitignore</p><p></p><p>%gitexe% show &gt; %romFolder%&#92;%folder_name%&#92;gitshow.txt</p><p>%gitexe% diff &gt; %romFolder%&#92;%folder_name%&#92;gitdiff.txt</p><p></p><p>rm .gitignore</p><p>mv .gitignore.back .gitignore</p><p>)</p><p></p><p>REM auto change version number</p><p>set verfile=modem_proc&#92;datamodem&#92;interface&#92;atcop&#92;inc&#92;hipad_version.h</p><p>IF EXIST %verfile% (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cp %verfile% %romFolder%&#92;%folder_name%&#92;original_hipad_verison.h</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mv %verfile% %verfile%.bak</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; echo #define HIPAD_WI_VER &quot;%romFolderNWname%%folder_name%&quot; &gt; %verfile%</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; cp %verfile% %romFolder%&#92;%folder_name%&#92;current_hipad_verison.h</p><p>)</p><p></p><p>REM del previous build mbn</p><p>cd modem_proc&#92;build&#92;ms&#92;</p><p>IF EXIST bin&#92;%binfolder%&#92;qdsp6sw.mbn del bin&#92;%binfolder%&#92;qdsp6sw.mbn</p><p>CALL build.cmd %buildcmd% BUILD_ID=%binfolder%</p><p>copy build.log %romFolder%&#92;%folder_name%&#92;</p><p></p><p>REM rollback version number file</p><p>IF EXIST ..&#92;..&#92;..&#92;%verfile%.bak (</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; rm ..&#92;..&#92;..&#92;%verfile%</p><p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; mv ..&#92;..&#92;..&#92;%verfile%.bak ..&#92;..&#92;..&#92;%verfile%</p><p>)</p><p></p><p>IF NOT EXIST bin&#92;%binfolder%&#92;qdsp6sw.mbn (</p><p>REM build code fail</p><p></p><p>set mailsubject=%mailsubjectheader%[%folder_name%][%gitbranch%]Fail</p><p>set mailbody=&quot;%romFolderNWname%%folder_name%&quot;</p><p>) else (</p><p>REM build code successful, do py update_info</p><p></p><p>CALL robocopy . %romFolder%&#92;%folder_name%&#92;modem /e</p><p></p><p>cd ..&#92;..&#92;..&#92;common&#92;build</p><p>CALL python update_common_info.py</p><p></p><p>CALL robocopy bin&#92;asic %romFolder%&#92;%folder_name% /e</p><p></p><p>set mailsubject=%mailsubjectheader%[%folder_name%][%gitbranch%]Success</p><p>set mailbody=&quot;#define HIPAD_WI_VER %romFolderNWname%%folder_name%&quot;</p><p>)</p><p></p><p>cd %scriptfolder%</p><p>sendEmail.exe -f %mailacc% -t %mailto% -u %mailsubject% -m &quot;%mailbody% %message%&quot; -s %gmailsmtp% -xu %mailacc% -xp %mailpwd%</p><p></p></body>
</html>
